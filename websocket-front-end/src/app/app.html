<div style="padding: 20px;">
    <h1>Support Agent Dashboard</h1>
    
    <!-- Phone Number Search -->
    <div style="margin-bottom: 30px; padding: 20px; border: 1px solid #ccc; border-radius: 5px;">
        <h3>Search Device by Phone Number</h3>
        <div style="display: flex; gap: 10px; align-items: center;">
            <input 
                type="text" 
                [(ngModel)]="phoneNumber" 
                placeholder="Enter phone number" 
                style="padding: 8px; width: 200px; border: 1px solid #ccc; border-radius: 3px;">
            <button 
                (click)="searchDevice()" 
                [disabled]="isSearching"
                style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer;">
                {{ isSearching ? 'Searching...' : 'Search Device' }}
            </button>
            <button 
                *ngIf="sessionId && deviceData?.deviceId"
                (click)="endSession()" 
                style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer;">
                End Session
            </button>
        </div>
        <p *ngIf="searchStatus" [style.color]="searchStatus.includes('Error') ? 'red' : 'green'">{{ searchStatus }}</p>
    </div>
    
    <!-- Device Data Display -->
    <div *ngIf="deviceData?.deviceId">
        <h2>Device: {{ deviceData?.phoneNumber }} ({{ deviceData?.deviceId }})</h2>
        <p>Last Update: {{ lastUpdate }}</p>
        <p>Response Type: {{ deviceData?.responseType || 'Unknown' }}</p>
        <p>Session ID: {{ deviceData?.sessionId || 'Unknown' }}</p>
        
        <!-- Payload Information -->
        <div style="background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <h4>Payload Info:</h4>
            <p>Size: {{ (payloadInfo.size / 1024).toFixed(1) }}KB</p>
            <p *ngIf="payloadInfo.compressed">Compressed: ✅</p>
            <p *ngIf="payloadInfo.chunks > 0">Chunks: {{ payloadInfo.chunks }}</p>
            <p *ngIf="deviceData?.compressed">Backend Compressed: {{ deviceData?.compressed ? '✅' : '❌' }}</p>
        </div>
        
        <!-- Device Response Data -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <h3>Response Info</h3>
                <p>Response Time: {{ deviceData?.responseTime || 'Unknown' }}</p>
                <p>Data Size: {{ deviceData?.dataSize || 'Unknown' }} bytes</p>
                <p>Chunks: {{ deviceData?.chunks || 0 }}</p>
            </div>
            <div>
                <h3>Device Details</h3>
                <div *ngIf="deviceData?.deviceDetails">
                    <pre style="background: #f0f8ff; padding: 10px; border-radius: 5px; font-size: 12px;">{{ deviceData.deviceDetails | json }}</pre>
                </div>
                <div *ngIf="!deviceData?.deviceDetails">
                    <p>Device ID: {{ deviceData?.deviceId }}</p>
                    <p>Response Type: {{ deviceData?.responseType }}</p>
                    <p>Status: Device Response Received ✅</p>
                </div>
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 20px;">
            <div>
                <h3>Device Telemetry</h3>
                <div *ngIf="deviceData?.deviceTelemetry">
                    <pre style="background: #f5f5f5; padding: 10px; border-radius: 5px; font-size: 12px;">{{ deviceData.deviceTelemetry | json }}</pre>
                </div>
                <div *ngIf="!deviceData?.deviceTelemetry">
                    <p>Data Size: {{ deviceData?.dataSize }} bytes</p>
                    <p>Response Time: {{ deviceData?.responseTime }}</p>
                    <p>Status: No Telemetry Data Available</p>
                </div>
            </div>
        </div>
    </div>
    
    <div *ngIf="!deviceData?.deviceId && !isSearching" style="text-align: center; margin-top: 50px;">
        <p>Enter a phone number to search for device information</p>
    </div>
</div>

<router-outlet />
